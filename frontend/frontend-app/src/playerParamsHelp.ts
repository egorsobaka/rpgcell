/**
 * Справочник параметров игрока
 * Описание всех параметров: откуда берутся, как рассчитываются, на что влияют
 */

export interface ParamHelp {
  name: string;
  description: string;
  source: string; // Откуда берется
  calculation: string; // Как рассчитывается
  effects: string; // На что влияет
  initialValue?: string;
  upgrade?: string; // Как улучшается
}

export const playerParamsHelp: Record<string, ParamHelp> = {
  satiety: {
    name: 'Сытость',
    description: 'Текущий уровень сытости игрока. Определяет возможность движения и тапанья клеток.',
    source: 'Начальное значение: 255. Восстанавливается при использовании ресурсов из инвентаря (параметр food клетки).',
    calculation: 'Тратится при движении: moveCost = max(1, round(weight × 0.01 × (collectionPower - stamina)))). Тратится при тапанье клеток: foodCost = max(0, collectionPower - (power + stamina + defense) / 3). Не может превышать weight.',
    effects: 'Если satiety < moveCost, игрок не может двигаться. Если satiety < foodCost, игрок не может тапать клетки. Определяет выживаемость игрока.',
    initialValue: '255',
  },
  weight: {
    name: 'Вес / Максимальная сытость',
    description: 'Максимальное значение сытости и влияет на максимальный вес инвентаря.',
    source: 'Начальное значение: 255. Увеличивается при улучшении параметра "Вес" или при достижении порога съеденной еды.',
    calculation: 'При улучшении: weight = Math.round(weight × 1.1) (увеличение на 10%). При достижении порога съеденной еды (weight × level): weight += weight × 0.1 × (min(collectionPower, power, stamina, defense) / (collectionPower + power + stamina + defense)), счетчик съеденной еды сбрасывается. Максимальный вес инвентаря: maxWeight = (weight / 2) + (weight / 2 × stamina / 10).',
    effects: 'Определяет максимальное значение satiety. Влияет на максимальный вес инвентаря. Влияет на стоимость движения (чем больше weight, тем больше тратится сытости на ход).',
    initialValue: '255',
    upgrade: 'Увеличивается на 10% при улучшении или автоматически при достижении порога съеденной еды',
  },
  totalFoodEaten: {
    name: 'Съедено еды',
    description: 'Общее количество съеденной еды. Увеличивается при трате сытости за тапанье клеток и при использовании предметов из инвентаря.',
    source: 'Начальное значение: 0. Увеличивается на количество потраченной сытости при тапанье клеток и при использовании предметов из инвентаря.',
    calculation: 'При тапанье клеток: totalFoodEaten += max(0, collectionPower - (power + stamina + defense) / 3). При использовании предметов: totalFoodEaten += food (параметр клетки). Сбрасывается при достижении порога сытости для увеличения веса.',
    effects: 'Используется для отслеживания прогресса к увеличению веса. При достижении порога сытости (weight + weight × 0.1 × collectionPower) вес увеличивается, а счетчик сбрасывается.',
    initialValue: '0',
  },
  stamina: {
    name: 'Выносливость',
    description: 'Снижает трату сытости при движении и увеличивает максимальный вес инвентаря.',
    source: 'Начальное значение: 1. Увеличивается при улучшении параметра "Выносливость".',
    calculation: 'Используется в формуле траты сытости: moveCost = max(1, round(weight × 0.01 × (collectionPower - stamina))). Чем выше stamina, тем меньше тратится сытости.',
    effects: 'Снижает трату сытости при движении. Увеличивает максимальный вес инвентаря. Влияет на множитель сбора клеток.',
    initialValue: '1',
    upgrade: 'Увеличивается на 1 при улучшении',
  },
  collectionPower: {
    name: 'Сила сбора',
    description: 'Определяет количество собираемых единиц за тап и максимальную силу собираемых клеток.',
    source: 'Начальное значение: 10. Увеличивается при улучшении параметра "Сила сбора".',
    calculation: 'Количество за тап: collectionPower × ((power + stamina) / (power + stamina + defense)). Максимальная сила клетки: collectionPower × multiplier - 1, где multiplier = (power / 2) + (stamina / 2) - defense (минимум 0.1).',
    effects: 'Определяет количество собираемых единиц за тап. Определяет максимальную силу клеток, которые можно собрать. Влияет на трату сытости при движении (чем выше, тем больше тратится).',
    initialValue: '10',
    upgrade: 'Увеличивается на 1 при улучшении',
  },
  power: {
    name: 'Сила атаки',
    description: 'Определяет урон при атаке других игроков и влияет на множитель сбора клеток.',
    source: 'Начальное значение: 1. Увеличивается при улучшении параметра "Сила".',
    calculation: 'Урон при атаке: damage = power. Урон вычитается из satiety цели. Влияет на множитель сбора: multiplier = (power / 2) + (stamina / 2) - defense.',
    effects: 'Определяет урон при атаке других игроков. Влияет на множитель сбора клеток (чем выше, тем больше клеток доступно для сбора). Влияет на количество собираемых единиц за тап.',
    initialValue: '1',
    upgrade: 'Увеличивается на 1 при улучшении',
  },
  experience: {
    name: 'Опыт',
    description: 'Накопленный опыт для повышения уровня.',
    source: 'Начальное значение: 0. Получается при использовании ресурсов из инвентаря (параметр experience клетки).',
    calculation: 'Требуется для повышения уровня: requiredExperience = начальный опыт + начальный опыт × level × 0.1 (начальный опыт = 255). При достижении уровня: experience -= requiredExperience, level += 1, availableUpgrades += 1.',
    effects: 'Определяет возможность повышения уровня. При достижении уровня игрок получает 1 улучшение.',
    initialValue: '0',
  },
  level: {
    name: 'Уровень',
    description: 'Уровень игрока. Определяет требования к опыту для следующего уровня.',
    source: 'Начальное значение: 1. Повышается при накоплении опыта.',
    calculation: 'Повышается при накоплении опыта: requiredExperience = начальный опыт + начальный опыт × level × 0.1 (начальный опыт = 255). При повышении уровня: level += 1, availableUpgrades += 1.',
    effects: 'Влияет на требования к опыту для следующего уровня. Влияет на вероятность больших значений при сборе ресурсов (вместе с удачей).',
    initialValue: '1',
  },
  health: {
    name: 'Здоровье',
    description: 'Текущее здоровье игрока. Отдельно от satiety, используется для PvP.',
    source: 'Начальное значение: 100. Восстанавливается со временем через regeneration.',
    calculation: 'Тратится при получении урона: health = max(0, health - actualDamage), где actualDamage = max(1, damage - defense). Восстанавливается: health += regeneration (если health < maxHealth).',
    effects: 'Если health <= 0, игрок не может атаковать (но может двигаться). Определяет выживаемость в PvP.',
    initialValue: '100',
  },
  maxHealth: {
    name: 'Максимальное здоровье',
    description: 'Максимальное значение здоровья игрока.',
    source: 'Начальное значение: 100. Увеличивается при улучшении параметра "Максимальное здоровье".',
    calculation: 'При улучшении: maxHealth = Math.round(maxHealth × 1.2) (увеличение на 20%). При улучшении health также увеличивается пропорционально.',
    effects: 'Определяет максимальное значение health. Влияет на выживаемость в PvP.',
    initialValue: '100',
    upgrade: 'Увеличивается на 20% при улучшении',
  },
  defense: {
    name: 'Защита',
    description: 'Снижает получаемый урон и влияет на множитель сбора клеток.',
    source: 'Начальное значение: 0. Увеличивается при улучшении параметра "Защита".',
    calculation: 'Снижает получаемый урон: actualDamage = max(1, damage - defense). Минимальный урон всегда 1. Влияет на множитель сбора: multiplier = (power / 2) + (stamina / 2) - defense (уменьшает его).',
    effects: 'Снижает получаемый урон при атаке. Уменьшает множитель сбора клеток (меньше клеток доступно для сбора). Влияет на количество собираемых единиц за тап.',
    initialValue: '0',
    upgrade: 'Увеличивается на 1 при улучшении',
  },
  luck: {
    name: 'Удача',
    description: 'Влияет на количество собираемых ресурсов за тап.',
    source: 'Начальное значение: 0. Увеличивается при улучшении параметра "Удача".',
    calculation: 'Влияет на вероятность выпадения N единиц (от 1 до 10): вероятность выпадения N = (luck / N × level). Чем выше удача и уровень, тем выше вероятность больших значений.',
    effects: 'Влияет на количество собираемых ресурсов за тап. Чем выше удача и уровень, тем выше вероятность больших значений (1-10).',
    initialValue: '0',
    upgrade: 'Увеличивается на 1 при улучшении',
  },
  regeneration: {
    name: 'Регенерация',
    description: 'Восстанавливает satiety каждые 10 секунд.',
    source: 'Начальное значение: 0. Увеличивается при улучшении параметра "Регенерация".',
    calculation: 'Восстанавливает satiety каждые 10 секунд: satiety = min(weight, satiety + regeneration). Не может превышать weight.',
    effects: 'Восстанавливает satiety автоматически. Улучшает выживаемость игрока.',
    initialValue: '0',
    upgrade: 'Увеличивается на 0.5 при улучшении',
  },
  'collected-per-tap': {
    name: 'Кол-во за тап',
    description: 'Количество собираемых единиц за один тап по клетке.',
    source: 'Рассчитывается на основе collectionPower, power, stamina и defense.',
    calculation: 'collectedAmount = collectionPower × ((power + stamina) / (power + stamina + defense)). Округляется вверх (ceil). Минимум: 1.',
    effects: 'Определяет эффективность сбора ресурсов. Чем выше значение, тем больше ресурсов собирается за тап.',
  },
  'collection-multiplier': {
    name: 'Множитель сбора',
    description: 'Множитель для определения максимальной силы собираемых клеток.',
    source: 'Рассчитывается на основе power, stamina и defense.',
    calculation: 'multiplier = (power / 2) + (stamina / 2) - defense. Минимум: 0.1. Используется для проверки возможности сбора: cellPower < collectionPower × multiplier.',
    effects: 'Определяет максимальную силу клеток, которые можно собрать. Чем выше множитель, тем больше клеток доступно для сбора.',
  },
  'max-cell-power': {
    name: 'Макс. сила клетки',
    description: 'Максимальная сила клетки, которую можно собрать.',
    source: 'Рассчитывается на основе collectionPower и множителя сбора.',
    calculation: 'maxCellPower = collectionPower × multiplier - 1, где multiplier = (power / 2) + (stamina / 2) - defense (минимум 0.1).',
    effects: 'Определяет максимальную силу клеток, которые можно собрать. Чем выше значение, тем больше клеток доступно для сбора.',
  },
  'move-cost': {
    name: 'Сытость на ход',
    description: 'Количество сытости, которое тратится при каждом движении.',
    source: 'Рассчитывается на основе weight, collectionPower и stamina.',
    calculation: 'moveCost = max(1, round(weight × 0.01 × (collectionPower - stamina))). Минимум: 1. Тратится при каждом движении.',
    effects: 'Определяет стоимость движения. Чем выше значение, тем больше сытости тратится при движении. Если satiety < moveCost, игрок не может двигаться.',
  },
  'experience-to-next': {
    name: 'Опыт до след. уровня',
    description: 'Количество опыта, необходимое для повышения уровня.',
    source: 'Рассчитывается на основе текущего уровня.',
    calculation: 'requiredExperience = начальный опыт + начальный опыт × level × 0.1 (начальный опыт = 255). Текущий опыт / требуемый опыт.',
    effects: 'Определяет прогресс к следующему уровню. При достижении уровня игрок получает 1 улучшение.',
  },
  weightIncrease: {
    name: 'До повышения веса',
    description: 'Количество еды, которое нужно съесть для автоматического увеличения веса.',
    source: 'Рассчитывается на основе текущего веса, уровня игрока и количества уже съеденной еды.',
    calculation: 'Порог съеденной еды: foodThreshold = weight × level. Нужно съесть: foodNeeded = max(0, foodThreshold - totalFoodEaten).',
    effects: 'При достижении порога съеденной еды вес автоматически увеличивается на: weight × 0.1 × (min(collectionPower, power, stamina, defense) / (collectionPower + power + stamina + defense)), а счетчик съеденной еды сбрасывается.',
  },
};

/**
 * Получить описание параметра по ключу
 */
export function getParamHelp(paramKey: string): ParamHelp | undefined {
  return playerParamsHelp[paramKey];
}

/**
 * Получить все параметры
 */
export function getAllParamsHelp(): Record<string, ParamHelp> {
  return playerParamsHelp;
}
